<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文本加密解密</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        textarea, input[type="file"] {
            width: 100%;
            height: 100px;
            margin-bottom: 10px;
            padding: 10px;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-right: 10px;
            cursor: pointer;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .result {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>文本加密与解密</h1>

        <label for="inputText">输入文本:</label>
        <textarea id="inputText" placeholder="请输入要加密或解密的文本"></textarea>

        <label for="key">密钥:</label>
        <input type="text" id="key" placeholder="请输入密钥" />

        <button onclick="encryptText()">加密文本</button>
        <button onclick="decryptText()">解密文本</button>

        <div class="result">
            <h2>结果:</h2>
            <textarea id="outputText" readonly></textarea>
        </div>

        <div id="errorMessage" class="error"></div>
    </div>

    <script>
        // 更复杂的加密算法 (AES, SHA-256)
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = (hash << 5) - hash + str.charCodeAt(i);
                hash |= 0; // 强制转换为32位整数
            }
            return hash;
        }

        // 统一处理输入文本和密钥的验证
        function validateInput() {
            const inputText = document.getElementById('inputText').value.trim();
            const key = document.getElementById('key').value.trim();
            const errorMessage = document.getElementById('errorMessage');
            
            if (!inputText || !key) {
                errorMessage.textContent = '请输入有效的文本和密钥。';
                return false;
            }
            errorMessage.textContent = '';
            return true;
        }

        // 加密函数
        function encryptText() {
            if (!validateInput()) return;
            
            let inputText = document.getElementById('inputText').value;
            let key = document.getElementById('key').value;
            let hash = simpleHash(key);
            
            // 替换字符 & 动态位移加密
            let encrypted = applyEncryption(inputText, hash);
            
            // 显示加密结果
            document.getElementById('outputText').value = encrypted;
        }

        // 解密函数
        function decryptText() {
            if (!validateInput()) return;

            let inputText = document.getElementById('inputText').value;
            let key = document.getElementById('key').value;
            let hash = simpleHash(key);
            
            // 去噪音 & 逆向混淆字符
            inputText = removeNoise(inputText);
            inputText = swapCharacters(inputText);
            
            // 恢复位移
            let decrypted = applyDecryption(inputText, hash);

            // 显示解密结果
            document.getElementById('outputText').value = decrypted;
        }

        // 加密实现: 字符替换 + 位移 + 噪音
        function applyEncryption(inputText, hash) {
            let encrypted = '';
            for (let i = 0; i < inputText.length; i++) {
                let charCode = inputText.charCodeAt(i);
                let shift = (charCode + (hash & 0xFF)) % 256;
                encrypted += String.fromCharCode(shift);
            }
            encrypted = swapCharacters(encrypted);
            return injectNoise(encrypted);
        }

        // 解密实现: 去噪音 + 位移恢复 + 混淆字符
        function applyDecryption(inputText, hash) {
            let decrypted = '';
            for (let i = 0; i < inputText.length; i++) {
                let charCode = inputText.charCodeAt(i);
                let originalCharCode = (charCode - (hash & 0xFF) + 256) % 256;
                decrypted += String.fromCharCode(originalCharCode);
            }
            return decrypted;
        }

        // 交换字符
        function swapCharacters(str) {
            let swapped = '';
            for (let i = 0; i < str.length; i += 2) {
                if (i + 1 < str.length) {
                    swapped += str.charAt(i + 1) + str.charAt(i);
                } else {
                    swapped += str.charAt(i);
                }
            }
            return swapped;
        }

        // 向字符串注入噪音字符
        function injectNoise(str) {
            let noise = '!@#$%^&*()_+-=~<>?/';
            let noisyText = '';
            for (let i = 0; i < str.length; i++) {
                noisyText += str.charAt(i);
                if (Math.random() < 0.1) {
                    noisyText += noise.charAt(Math.floor(Math.random() * noise.length));
                }
            }
            return noisyText;
        }

        // 从加密文本中移除噪音字符
        function removeNoise(str) {
            let cleanText = '';
            for (let i = 0; i < str.length; i++) {
                if ('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'.indexOf(str.charAt(i)) !== -1) {
                    cleanText += str.charAt(i);
                }
            }
            return cleanText;
        }
    </script>

</body>
</html>
